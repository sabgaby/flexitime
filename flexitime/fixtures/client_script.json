[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Leave Application",
  "enabled": 1,
  "modified": "2025-12-09 21:53:54.421991",
  "module": "Flexitime",
  "name": "Leave Application - Calendar Link",
  "script": "frappe.ui.form.on('Leave Application', {\n\trefresh: function(frm) {\n\t\trender_calendar_link(frm);\n\t},\n\tstatus: function(frm) {\n\t\trender_calendar_link(frm);\n\t}\n});\n\nfunction render_calendar_link(frm) {\n\tif (frm.doc.status !== 'Approved' || !frm.doc.from_date || !frm.doc.to_date) {\n\t\tfrm.set_df_property('google_calendar_link', 'options', '');\n\t\treturn;\n\t}\n\n\t// Check if we have an actual calendar event URL (event was created in Google Calendar)\n\tif (frm.doc.google_calendar_event_url) {\n\t\t// Show link to the actual event\n\t\tconst html = `\n\t\t\t<div class=\"calendar-link-container\" style=\"padding: 8px 0;\">\n\t\t\t\t<p style=\"margin-bottom: 8px; color: var(--text-muted); font-size: var(--text-sm);\">\n\t\t\t\t\tThis leave has been added to the shared Leaves Calendar:\n\t\t\t\t</p>\n\t\t\t\t<a href=\"${frm.doc.google_calendar_event_url}\" target=\"_blank\" class=\"btn btn-primary btn-sm\" style=\"display: inline-flex; align-items: center; gap: 6px;\">\n\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n\t\t\t\t\t\t<path d=\"M19.5 3h-15A1.5 1.5 0 003 4.5v15A1.5 1.5 0 004.5 21h15a1.5 1.5 0 001.5-1.5v-15A1.5 1.5 0 0019.5 3zM12 18a6 6 0 110-12 6 6 0 010 12zm0-10.5a4.5 4.5 0 100 9 4.5 4.5 0 000-9z\"/>\n\t\t\t\t\t\t<path d=\"M12 8v4l3 1.5\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\tView in Google Calendar\n\t\t\t\t</a>\n\t\t\t\t<p style=\"margin-top: 8px; color: var(--text-muted); font-size: var(--text-xs);\">\n\t\t\t\t\tThe employee will receive a calendar invitation. All staff can view and edit this event.\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t`;\n\t\tfrm.set_df_property('google_calendar_link', 'options', html);\n\t\treturn;\n\t}\n\n\t// Fallback: Show generic \"Add to Calendar\" link if event hasn't been created yet\n\t// (for backward compatibility or if calendar sync is disabled)\n\tconst employee_name = frm.doc.employee_name || frm.doc.employee;\n\tconst leave_type = frm.doc.leave_type || 'Leave';\n\n\t// Format dates for Google Calendar (YYYYMMDD format for all-day events)\n\tconst from_date = frm.doc.from_date.replace(/-/g, '');\n\t// Google Calendar expects end date to be the day AFTER for all-day events\n\tconst to_date_obj = frappe.datetime.str_to_obj(frm.doc.to_date);\n\tto_date_obj.setDate(to_date_obj.getDate() + 1);\n\tconst to_date = frappe.datetime.obj_to_str(to_date_obj).replace(/-/g, '');\n\n\t// Build event title and description\n\tconst title = encodeURIComponent(`${employee_name} - ${leave_type}`);\n\tconst description = encodeURIComponent(`Leave Application: ${frm.doc.name}\\nEmployee: ${employee_name}\\nType: ${leave_type}\\nFrom: ${frm.doc.from_date}\\nTo: ${frm.doc.to_date}`);\n\n\t// Google Calendar URL for adding an event\n\tconst google_url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${from_date}/${to_date}&details=${description}`;\n\n\t// Render HTML with styled link\n\tconst html = `\n\t\t<div class=\"calendar-link-container\" style=\"padding: 8px 0;\">\n\t\t\t<p style=\"margin-bottom: 8px; color: var(--text-muted); font-size: var(--text-sm);\">\n\t\t\t\tAdd this leave to your personal Google Calendar:\n\t\t\t</p>\n\t\t\t<a href=\"${google_url}\" target=\"_blank\" class=\"btn btn-default btn-sm\" style=\"display: inline-flex; align-items: center; gap: 6px;\">\n\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n\t\t\t\t\t<path d=\"M19.5 3h-15A1.5 1.5 0 003 4.5v15A1.5 1.5 0 004.5 21h15a1.5 1.5 0 001.5-1.5v-15A1.5 1.5 0 0019.5 3zM12 18a6 6 0 110-12 6 6 0 010 12zm0-10.5a4.5 4.5 0 100 9 4.5 4.5 0 000-9z\"/>\n\t\t\t\t\t<path d=\"M12 8v4l3 1.5\"/>\n\t\t\t\t</svg>\n\t\t\t\tAdd to Google Calendar\n\t\t\t</a>\n\t\t\t<p style=\"margin-top: 8px; color: var(--text-muted); font-size: var(--text-xs);\">\n\t\t\t\tNote: If calendar sync is enabled, this event will be automatically added to the shared Leaves Calendar.\n\t\t\t</p>\n\t\t</div>\n\t`;\n\n\tfrm.set_df_property('google_calendar_link', 'options', html);\n}",
  "view": "Form"
 }
]